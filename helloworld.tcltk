(copy from coagulate, the tcl one doesn't work for wish)